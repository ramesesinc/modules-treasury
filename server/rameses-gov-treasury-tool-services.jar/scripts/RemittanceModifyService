import com.rameses.annotations.*;

class RemittanceModifyService {

	@DataContext('remittance_fund') 
	def rem_fund_db; 

	@ActiveDB('remittance_modify')
	def rem_mod_db;


	@ProxyMethod 
	public void rebuildFund( param ) {
		if ( !param.remittanceid ) throw new Exception('remittanceid parameter is required'); 

		def findby = [ remittanceid: param.remittanceid ]; 
		rem_fund_db.find( findby ).delete(); 

		rem_mod_db.getBuildRemittanceFunds( findby ).each{ o-> 
			o.objid = o.remittanceid +'|'+ o.fund.objid; 
			o.controlno = o.remittanceno +'-'+ o.fund.code; 
			o.remittance = [objid: o.remittanceid]; 
			o.cashbreakdown = [];
			rem_fund_db.create( o );   
		} 
	}
}
